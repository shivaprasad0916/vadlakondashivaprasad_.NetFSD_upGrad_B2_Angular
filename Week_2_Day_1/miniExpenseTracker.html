<!DOCTYPE html>
<html>
<head>
    <title>Mini Expense Tracker - IndexedDB</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        input, button { margin: 5px; padding: 6px; }
        table { border-collapse: collapse; margin-top: 20px; width: 100%; }
        th, td { border: 1px solid #553a3a; padding: 8px; text-align: center; }
        th { background-color: #694646; }
    </style>
</head>
<body>

<h2>Mini Expense Tracker (IndexedDB)</h2>

<input type="text" id="title" placeholder="Expense Title">
<input type="number" id="amount" placeholder="Amount">
<input type="date" id="date">

<button onclick="addExpense()">Add Expense</button>
<button onclick="viewExpenses()">View Expenses</button>

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Amount</th>
            <th>Date</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody id="expenseList"></tbody>
</table>
<script>
let db;

// CREATE DATABASE & TABLE
const request = indexedDB.open("ExpenseDB", 1);
request.onupgradeneeded = function(event) {
    db = event.target.result;

    // CREATE TABLE equivalent
    if (!db.objectStoreNames.contains("expenses")) {
        db.createObjectStore("expenses", {
            keyPath: "id",
            autoIncrement: true
        });
        console.log("Object Store Created");
    }
};
request.onsuccess = function(event) {
    db = event.target.result;
    console.log("Database opened successfully");
};
request.onerror = function(event) {
    console.error("Database error:", event.target.error);
};

// INSERT (Add Expense)
function addExpense() {
    const title = document.getElementById("title").value;
    const amount = document.getElementById("amount").value;
    const date = document.getElementById("date").value;
    if (!title || !amount || !date) {
        alert("Please fill all fields");
        return;
    }
    const transaction = db.transaction(["expenses"], "readwrite");
    const store = transaction.objectStore("expenses");
    const expense = { title, amount, date };
    const request = store.add(expense);
    request.onsuccess = () => {
        alert("Expense Added Successfully");
        viewExpenses();
    };
    request.onerror = (event) => {
        console.error("Insert Error:", event.target.error);
    };
    transaction.onerror = (event) => {
        console.error("Transaction Error:", event.target.error);
    };
}
// SELECT (View Expenses)
function viewExpenses() {
    const transaction = db.transaction(["expenses"], "readonly");
    const store = transaction.objectStore("expenses");
    const request = store.getAll();
    request.onsuccess = () => {
        const expenses = request.result;
        const list = document.getElementById("expenseList");
        list.innerHTML = "";
        expenses.forEach(exp => {
            list.innerHTML += `
                <tr>
                    <td>${exp.id}</td>
                    <td>${exp.title}</td>
                    <td>${exp.amount}</td>
                    <td>${exp.date}</td>
                    <td>
                        <button onclick="deleteExpense(${exp.id})">Delete</button>
                    </td>
                </tr>
            `;
        });
    };
    request.onerror = (event) => {
        console.error("Select Error:", event.target.error);
    };
}

// DELETE Expense
function deleteExpense(id) {
    const transaction = db.transaction(["expenses"], "readwrite");
    const store = transaction.objectStore("expenses");
    const request = store.delete(id);
    request.onsuccess = () => {
        alert("Expense Deleted");
        viewExpenses();
    };
    request.onerror = (event) => {
        console.error("Delete Error:", event.target.error);
    };
    transaction.onerror = (event) => {
        console.error("Transaction Error:", event.target.error);
    };
}
</script>
</body>
</html>